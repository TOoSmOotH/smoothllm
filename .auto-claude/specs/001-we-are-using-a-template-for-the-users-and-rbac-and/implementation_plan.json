{
  "feature": "Smooth LLM Proxy - API Key Management and Usage Tracking",
  "workflow_type": "feature",
  "workflow_rationale": "Adding substantial new LLM proxy capabilities to an existing smoothweb template. Requires new database models, API endpoints, services, and frontend views while leveraging existing auth, RBAC, and user management infrastructure.",
  "phases": [
    {
      "id": "phase-1-database",
      "name": "Database Models & Migrations",
      "type": "implementation",
      "description": "Create the database models and migrations for providers, API keys, and usage tracking",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Create Provider model for LLM provider configurations",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/internal/custom/models/provider.go"
          ],
          "patterns_from": [
            "backend/internal/models/user.go"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "notes": "Created Provider model in backend/internal/custom/models/provider.go with all required fields from spec. Includes UserID, Name, ProviderType, BaseURL, APIKey (hidden from JSON), IsActive, DefaultModel, InputCostPer1K, OutputCostPer1K. Added provider type constants and GetBaseURL() helper method. Note: go build verification could not be run due to command restrictions, but code follows user.go patterns exactly.",
          "updated_at": "2026-01-03T02:27:16.143189+00:00"
        },
        {
          "id": "subtask-1-2",
          "description": "Create ProxyAPIKey model for user-generated proxy keys",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/internal/custom/models/api_key.go"
          ],
          "patterns_from": [
            "backend/internal/models/user.go"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "notes": "Created ProxyAPIKey model in backend/internal/custom/models/api_key.go with all required fields from spec. Includes UserID, ProviderID, KeyHash (hidden from JSON with json:\"-\"), KeyPrefix, Name, IsActive, LastUsedAt, ExpiresAt. Added relationship to Provider with CASCADE delete. Added helper methods: IsExpired(), IsValid(), UpdateLastUsed() and ProxyAPIKeyPrefix constant. Note: go build verification could not be run due to command restrictions, but code follows provider.go and user.go patterns exactly.",
          "updated_at": "2026-01-03T02:28:59.226805+00:00"
        },
        {
          "id": "subtask-1-3",
          "description": "Create UsageRecord model for tracking LLM usage",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/internal/custom/models/usage.go"
          ],
          "patterns_from": [
            "backend/internal/models/user.go"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "notes": "Created UsageRecord model in backend/internal/custom/models/usage.go with all required fields from spec. Includes UserID, ProxyKeyID, ProviderID, Model, InputTokens, OutputTokens, TotalTokens, Cost, RequestDuration, StatusCode, ErrorMessage. Added relationships to ProxyAPIKey and Provider with CASCADE delete. Added helper methods: CalculateCost(), IsError(), IsSuccess(). Note: go build verification could not be run due to command restrictions, but code follows provider.go and api_key.go patterns exactly.",
          "updated_at": "2026-01-03T02:30:28.854492+00:00"
        },
        {
          "id": "subtask-1-4",
          "description": "Create custom migrations to auto-migrate new models",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/internal/custom/migrations.go"
          ],
          "patterns_from": [
            "backend/internal/database/migrations.go"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "notes": "Created backend/internal/custom/migrations.go with AutoMigrate function for Provider, ProxyAPIKey, and UsageRecord models. Follows pattern from backend/internal/database/migrations.go. Committed in 9194969.",
          "updated_at": "2026-01-03T02:32:00.837836+00:00"
        }
      ]
    },
    {
      "id": "phase-2-provider-backend",
      "name": "Provider Management Backend",
      "type": "implementation",
      "description": "Build the provider CRUD service, handlers, and routes",
      "depends_on": [
        "phase-1-database"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Create provider service with CRUD operations",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/internal/custom/services/providers.go"
          ],
          "patterns_from": [
            "backend/internal/services/profile_service.go"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "notes": "Created backend/internal/custom/services/providers.go with full CRUD operations. Includes ListProviders, GetProvider, CreateProvider, UpdateProvider, DeleteProvider, TestConnection, TestConnectionWithRequest, and GetProviderByIDInternal methods. Follows profile_service.go pattern with ProviderResponse struct (no API key), request structs, validation methods, and provider-specific connection testing. Note: go build verification could not be run due to command restrictions. Code follows established patterns. Committed in 5674719.",
          "updated_at": "2026-01-03T02:35:08.082852+00:00"
        },
        {
          "id": "subtask-2-2",
          "description": "Create provider handlers for API endpoints",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/internal/custom/handlers/providers.go"
          ],
          "patterns_from": [
            "backend/internal/handlers/auth.go"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "notes": "Created backend/internal/custom/handlers/providers.go with ProviderHandler struct following auth.go pattern. Implements all provider API endpoints: ListProviders (GET), GetProvider (GET :id), CreateProvider (POST), UpdateProvider (PUT :id), DeleteProvider (DELETE :id), TestConnection (POST :id/test), TestConnectionWithCredentials (POST /test). All handlers use auth.GetUserID for authentication, proper HTTP status codes, and delegate to ProviderService. Note: go build verification could not be run due to command restrictions, but code follows auth.go patterns exactly. Committed in 34f9e06.",
          "updated_at": "2026-01-03T02:37:00.300414+00:00"
        },
        {
          "id": "subtask-2-3",
          "description": "Register provider routes in custom routes.go",
          "service": "backend",
          "files_to_modify": [
            "backend/internal/custom/routes.go"
          ],
          "files_to_create": [],
          "patterns_from": [
            "backend/internal/custom/routes.go"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && go run cmd/api/main.go &>/dev/null & sleep 3 && curl -s http://localhost:8080/health && pkill -f 'go run'",
            "expected": "Server starts and health check responds"
          },
          "status": "completed",
          "notes": "Registered provider routes in backend/internal/custom/routes.go. Added imports for custom handlers and services packages. Call AutoMigrate on startup to run custom migrations. Initialized ProviderService and ProviderHandler. Registered all provider CRUD routes under /providers with JWT auth: GET / (list), POST / (create), POST /test (test credentials), GET /:id (get), PUT /:id (update), DELETE /:id (delete), POST /:id/test (test connection). Note: go build verification could not be run due to command restrictions, but code follows established patterns and imports verified. Committed in 7817852.",
          "updated_at": "2026-01-03T02:39:23.007774+00:00"
        }
      ]
    },
    {
      "id": "phase-3-keys-backend",
      "name": "API Key Management Backend",
      "type": "implementation",
      "description": "Build the proxy API key management service, handlers, and routes",
      "depends_on": [
        "phase-2-provider-backend"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Create keys service with key generation and hashing",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/internal/custom/services/keys.go"
          ],
          "patterns_from": [
            "backend/internal/services/profile_service.go"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "notes": "Created backend/internal/custom/services/keys.go with full key management service. Implements: KeyService struct with GORM db, KeyResponse/KeyCreateResponse structs (KeyCreateResponse includes full key only on creation), CreateKeyRequest/UpdateKeyRequest for API input, CRUD methods (ListKeys, GetKey, CreateKey, UpdateKey, DeleteKey, RevokeKey), ValidateKey for proxy authentication that checks hash and validity, secure key generation using crypto/rand (32 bytes = 256 bits entropy), SHA256 hashing for secure key storage, key prefix extraction for display (sk-smoothllm-xxx...yyy), validation including provider ownership check. Follows ProviderService patterns exactly. Note: go build verification could not be run due to command restrictions, but code follows established patterns and imports verified against go.mod. Committed in d076195.",
          "updated_at": "2026-01-03T02:41:56.544250+00:00"
        },
        {
          "id": "subtask-3-2",
          "description": "Create keys handlers for API key CRUD endpoints",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/internal/custom/handlers/keys.go"
          ],
          "patterns_from": [
            "backend/internal/handlers/auth.go"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "notes": "Created backend/internal/custom/handlers/keys.go with KeyHandler struct following auth.go and providers.go patterns. Implements all key management API endpoints: ListKeys (GET), GetKey (GET :id), CreateKey (POST), UpdateKey (PUT :id), DeleteKey (DELETE :id), RevokeKey (POST :id/revoke). All handlers use auth.GetUserID for authentication, proper HTTP status codes, and delegate to KeyService. Note: go build verification could not be run due to command restrictions, but code follows established patterns exactly. Committed in f920d19.",
          "updated_at": "2026-01-03T02:43:42.923393+00:00"
        },
        {
          "id": "subtask-3-3",
          "description": "Register keys routes in custom routes.go",
          "service": "backend",
          "files_to_modify": [
            "backend/internal/custom/routes.go"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "notes": "Registered key routes in backend/internal/custom/routes.go. Added KeyService and KeyHandler initialization. Registered all key management routes under /keys with JWT auth: GET / (list), POST / (create), GET /:id (get), PUT /:id (update), DELETE /:id (delete), POST /:id/revoke (revoke). Note: go build verification could not be run due to command restrictions, but code follows established patterns exactly and matches provider routes structure. Committed in e700320.",
          "updated_at": "2026-01-03T02:45:20.798956+00:00"
        }
      ]
    },
    {
      "id": "phase-4-proxy-backend",
      "name": "LLM Proxy Backend",
      "type": "implementation",
      "description": "Build the LLM request proxy service with model routing and request transformation",
      "depends_on": [
        "phase-3-keys-backend"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Create proxy service with reverse proxy, model routing, and provider-specific request transformation",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/internal/custom/services/proxy.go"
          ],
          "patterns_from": [],
          "notes": "Created backend/internal/custom/services/proxy.go with full LLM proxy service implementation. Features:\n- ProxyService struct with KeyService and ProviderService dependencies\n- OpenAIChatRequest/AnthropicRequest structs for request transformation\n- ParseModelName for LiteLLM-style model routing (e.g., \"openai/gpt-4o\", \"anthropic/claude-sonnet-4\")\n- ProxyRequest method for full request proxying with body transformation\n- ProxyWithReverseProxy method using httputil.ReverseProxy for streaming support\n- transformToAnthropic for OpenAI\u2192Anthropic format conversion (system message extraction, max_tokens injection)\n- User-Agent preservation with DefaultUserAgent fallback\n- Provider-specific auth headers (Bearer for OpenAI, x-api-key + anthropic-version for Anthropic)\n- Usage extraction from both OpenAI and Anthropic response formats\n- ListModels for returning available models per provider type\n- GetProxyKeyFromRequest for extracting proxy key from Authorization header\n- HandleProviderError for appropriate error responses\n\nNote: go build verification could not be run due to command restrictions, but code follows providers.go and keys.go patterns exactly. Committed in 1c7b239.",
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "updated_at": "2026-01-03T02:48:40.492728+00:00"
        },
        {
          "id": "subtask-4-2",
          "description": "Create proxy handler for /v1/chat/completions endpoint",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/internal/custom/handlers/proxy.go"
          ],
          "patterns_from": [
            "backend/internal/handlers/auth.go"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "notes": "Created backend/internal/custom/handlers/proxy.go with ProxyHandler struct following auth.go pattern. Implements ChatCompletions (POST /v1/chat/completions) and ListModels (GET /v1/models) handlers. Handlers use proxy API key authentication (not JWT), validate keys via ProxyService.ValidateAndGetProvider(), forward requests via ProxyService.ProxyRequest(), and return OpenAI-compatible error responses. Note: go build verification could not be run due to command restrictions, but code follows established handler patterns exactly. Committed in 7e37af7.",
          "updated_at": "2026-01-03T02:50:23.986018+00:00"
        },
        {
          "id": "subtask-4-3",
          "description": "Register proxy routes (outside /api/v1 group for OpenAI compatibility)",
          "service": "backend",
          "files_to_modify": [
            "backend/internal/custom/routes.go"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "notes": "Registered proxy routes in backend/internal/custom/routes.go. Added RegisterProxyRoutes function that registers /v1/chat/completions (POST) and /v1/models (GET) endpoints at the root router level (outside /api/v1) for OpenAI SDK compatibility. Also updated backend/cmd/api/main.go to call RegisterProxyRoutes. These routes use proxy API key authentication (Bearer sk-smoothllm-xxx), not JWT. Note: go build verification could not be run due to command restrictions, but code follows established patterns exactly. Committed in b106667.",
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "updated_at": "2026-01-03T02:53:17.080363+00:00"
        }
      ]
    },
    {
      "id": "phase-5-usage-backend",
      "name": "Usage Tracking Backend",
      "type": "implementation",
      "description": "Build the usage tracking service, handlers, and routes",
      "depends_on": [
        "phase-4-proxy-backend"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Create usage service for recording and querying usage data",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/internal/custom/services/usage.go"
          ],
          "patterns_from": [
            "backend/internal/services/profile_service.go"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "completed",
          "notes": "Created backend/internal/custom/services/usage.go with full usage tracking service. Implements: UsageService struct with GORM db, response structs (UsageSummaryResponse, DailyUsageResponse, UsageByKeyResponse, UsageByProviderResponse, UsageByModelResponse, UsageRecordResponse), RecordUsageRequest for capturing usage events, UsageQueryParams for filtering, RecordUsage() and RecordUsageAsync() for recording (async is non-blocking for proxy performance), GetUsageSummary() for overall stats, GetDailyUsage() for daily breakdown, GetUsageByKey() for per-key stats, GetUsageByProvider() for per-provider stats, GetUsageByModel() for per-model stats, GetRecentUsage() with pagination, GetUsageCount() for pagination support, applyFilters() helper. Follows profile_service.go, providers.go, and keys.go patterns exactly. Note: go build verification could not be run due to command restrictions, but code follows established patterns and imports verified. Committed in d818f7e.",
          "updated_at": "2026-01-03T02:56:06.326745+00:00"
        },
        {
          "id": "subtask-5-2",
          "description": "Create usage handlers for statistics endpoints",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "backend/internal/custom/handlers/usage.go"
          ],
          "patterns_from": [
            "backend/internal/handlers/auth.go"
          ],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "pending"
        },
        {
          "id": "subtask-5-3",
          "description": "Register usage routes and integrate usage recording into proxy",
          "service": "backend",
          "files_to_modify": [
            "backend/internal/custom/routes.go",
            "backend/internal/custom/services/proxy.go"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd backend && go build ./...",
            "expected": "Build succeeds with no errors"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-6-frontend-api",
      "name": "Frontend API Layer",
      "type": "implementation",
      "description": "Create the frontend API clients for providers, keys, and usage",
      "depends_on": [
        "phase-5-usage-backend"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "Create providers API client",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/api/providers.ts"
          ],
          "patterns_from": [
            "frontend/src/api/client.ts",
            "frontend/src/api/profile.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run type-check",
            "expected": "Type check passes"
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-2",
          "description": "Create keys API client",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/api/keys.ts"
          ],
          "patterns_from": [
            "frontend/src/api/client.ts",
            "frontend/src/api/profile.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run type-check",
            "expected": "Type check passes"
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-3",
          "description": "Create usage API client",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/api/usage.ts"
          ],
          "patterns_from": [
            "frontend/src/api/client.ts",
            "frontend/src/api/profile.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run type-check",
            "expected": "Type check passes"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-7-frontend-stores",
      "name": "Frontend Stores",
      "type": "implementation",
      "description": "Create Pinia stores for providers, keys, and usage state management",
      "depends_on": [
        "phase-6-frontend-api"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-7-1",
          "description": "Create providers Pinia store",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/stores/providers.ts"
          ],
          "patterns_from": [
            "frontend/src/stores/auth.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run type-check",
            "expected": "Type check passes"
          },
          "status": "pending"
        },
        {
          "id": "subtask-7-2",
          "description": "Create apiKeys Pinia store",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/stores/apiKeys.ts"
          ],
          "patterns_from": [
            "frontend/src/stores/auth.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run type-check",
            "expected": "Type check passes"
          },
          "status": "pending"
        },
        {
          "id": "subtask-7-3",
          "description": "Create usage Pinia store",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/stores/usage.ts"
          ],
          "patterns_from": [
            "frontend/src/stores/auth.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run type-check",
            "expected": "Type check passes"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-8-frontend-views",
      "name": "Frontend Views",
      "type": "implementation",
      "description": "Create the Vue components for providers, keys, and usage pages",
      "depends_on": [
        "phase-7-frontend-stores"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-8-1",
          "description": "Create Providers view with CRUD UI",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/views/Providers.vue"
          ],
          "patterns_from": [
            "frontend/src/views/Dashboard.vue",
            "frontend/src/views/ProfileEdit.vue"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run type-check",
            "expected": "Type check passes"
          },
          "status": "pending"
        },
        {
          "id": "subtask-8-2",
          "description": "Create ApiKeys view with key management UI",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/views/ApiKeys.vue"
          ],
          "patterns_from": [
            "frontend/src/views/Dashboard.vue"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run type-check",
            "expected": "Type check passes"
          },
          "status": "pending"
        },
        {
          "id": "subtask-8-3",
          "description": "Create Usage view with statistics dashboard",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/views/Usage.vue"
          ],
          "patterns_from": [
            "frontend/src/views/Dashboard.vue"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run type-check",
            "expected": "Type check passes"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-9-frontend-config",
      "name": "Frontend Configuration",
      "type": "implementation",
      "description": "Update app configuration with branding and navigation for Smooth LLM Proxy",
      "depends_on": [
        "phase-8-frontend-views"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-9-1",
          "description": "Update customAppConfig with Smooth LLM Proxy branding and navigation",
          "service": "frontend",
          "files_to_modify": [
            "frontend/src/custom/appConfig.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "frontend/src/config/appConfig.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run type-check",
            "expected": "Type check passes"
          },
          "status": "pending"
        },
        {
          "id": "subtask-9-2",
          "description": "Add custom routes for providers, keys, and usage pages",
          "service": "frontend",
          "files_to_modify": [
            "frontend/src/custom/routes.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "frontend/src/router/coreRoutes.ts"
          ],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run type-check",
            "expected": "Type check passes"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-10-integration",
      "name": "Integration Testing",
      "type": "integration",
      "description": "End-to-end verification of all features working together",
      "depends_on": [
        "phase-9-frontend-config"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-10-1",
          "description": "Verify backend API endpoints work correctly",
          "all_services": false,
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "api",
            "method": "GET",
            "url": "http://localhost:8080/health",
            "expected_status": 200
          },
          "status": "pending"
        },
        {
          "id": "subtask-10-2",
          "description": "Verify frontend builds and serves correctly",
          "all_services": false,
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run build",
            "expected": "Build succeeds with no errors"
          },
          "status": "pending"
        },
        {
          "id": "subtask-10-3",
          "description": "End-to-end verification of complete flow",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "1. Start backend with 'cd backend && go run cmd/api/main.go'",
              "2. Start frontend with 'cd frontend && npm run dev'",
              "3. Register a new user at http://localhost:5173/register",
              "4. Navigate to Providers page and add a provider",
              "5. Navigate to API Keys page and create a proxy key",
              "6. Test proxy endpoint with curl",
              "7. Verify usage appears in Usage dashboard"
            ]
          },
          "status": "pending"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 10,
    "total_subtasks": 28,
    "services_involved": [
      "backend",
      "frontend"
    ],
    "estimated_files_to_create": 18,
    "estimated_files_to_modify": 5,
    "parallelism": {
      "max_parallel_phases": 3,
      "parallel_groups": [
        {
          "phases": [
            "phase-6-frontend-api"
          ],
          "reason": "Frontend API can be developed after backend is complete"
        },
        {
          "phases": [
            "phase-7-frontend-stores"
          ],
          "reason": "Frontend stores depend on API layer"
        },
        {
          "phases": [
            "phase-8-frontend-views"
          ],
          "reason": "Frontend views depend on stores"
        }
      ],
      "recommended_workers": 1,
      "speedup_estimate": "Sequential execution recommended for this feature due to tight dependencies between phases"
    },
    "startup_command": "source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 001 --parallel 1"
  },
  "verification_strategy": {
    "risk_level": "high",
    "skip_validation": false,
    "test_creation_phase": "post_implementation",
    "test_types_required": [
      "unit",
      "integration",
      "e2e"
    ],
    "security_scanning_required": true,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "All Go code compiles without errors",
      "All TypeScript code passes type checking",
      "Frontend builds successfully",
      "Backend health check responds",
      "Provider CRUD operations work via API",
      "API key generation and validation work",
      "Proxy forwards requests to providers correctly",
      "Usage tracking records requests accurately",
      "Provider API keys are never exposed in API responses",
      "Client User-Agent is preserved in proxied requests"
    ],
    "verification_steps": [
      {
        "name": "Backend Build",
        "command": "cd backend && go build ./...",
        "expected_outcome": "Build succeeds with no errors",
        "type": "build",
        "required": true,
        "blocking": true
      },
      {
        "name": "Frontend Type Check",
        "command": "cd frontend && npm run type-check",
        "expected_outcome": "No type errors",
        "type": "lint",
        "required": true,
        "blocking": true
      },
      {
        "name": "Frontend Build",
        "command": "cd frontend && npm run build",
        "expected_outcome": "Build succeeds",
        "type": "build",
        "required": true,
        "blocking": true
      },
      {
        "name": "Backend Unit Tests",
        "command": "cd backend && go test ./...",
        "expected_outcome": "All tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Frontend Unit Tests",
        "command": "cd frontend && npm test -- --run",
        "expected_outcome": "All tests pass",
        "type": "test",
        "required": true,
        "blocking": false
      },
      {
        "name": "Secrets Scan",
        "command": "grep -rn 'sk-' --include='*.go' --include='*.ts' backend/ frontend/ | grep -v 'sk-smoothllm' | grep -v 'sk-{' | head -5",
        "expected_outcome": "No hardcoded API keys found",
        "type": "security",
        "required": true,
        "blocking": true
      }
    ],
    "reasoning": "High risk due to API key management security requirements. Requires comprehensive testing to ensure keys are never exposed and proxy correctly handles provider authentication."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": true,
      "commands": [
        "cd backend && go test ./...",
        "cd frontend && npm test -- --run"
      ],
      "minimum_coverage": null
    },
    "integration_tests": {
      "required": true,
      "commands": [
        "cd backend && go test -tags=integration ./..."
      ],
      "services_to_test": [
        "backend"
      ]
    },
    "e2e_tests": {
      "required": false,
      "commands": [
        "cd frontend && npx playwright test"
      ],
      "flows": [
        "provider-crud",
        "key-management",
        "proxy-request"
      ]
    },
    "browser_verification": {
      "required": true,
      "pages": [
        {
          "url": "http://localhost:5173/",
          "checks": [
            "Branding shows 'Smooth LLM Proxy'",
            "No console errors"
          ]
        },
        {
          "url": "http://localhost:5173/providers",
          "checks": [
            "Page renders",
            "Can add provider form visible"
          ]
        },
        {
          "url": "http://localhost:5173/keys",
          "checks": [
            "Page renders",
            "Can create key button visible"
          ]
        },
        {
          "url": "http://localhost:5173/usage",
          "checks": [
            "Page renders",
            "Usage stats display"
          ]
        }
      ]
    },
    "database_verification": {
      "required": true,
      "checks": [
        "providers table exists",
        "proxy_api_keys table exists",
        "usage_records table exists",
        "Foreign keys configured correctly"
      ]
    },
    "api_verification": {
      "required": true,
      "endpoints": [
        {
          "method": "GET",
          "path": "/api/v1/providers",
          "auth": "jwt",
          "expected_status": 200
        },
        {
          "method": "POST",
          "path": "/api/v1/providers",
          "auth": "jwt",
          "expected_status": 201
        },
        {
          "method": "GET",
          "path": "/api/v1/keys",
          "auth": "jwt",
          "expected_status": 200
        },
        {
          "method": "POST",
          "path": "/api/v1/keys",
          "auth": "jwt",
          "expected_status": 201
        },
        {
          "method": "GET",
          "path": "/api/v1/usage",
          "auth": "jwt",
          "expected_status": 200
        },
        {
          "method": "POST",
          "path": "/v1/chat/completions",
          "auth": "proxy_key",
          "expected_status": 200
        }
      ]
    },
    "security_verification": {
      "required": true,
      "checks": [
        "Provider API keys never returned in GET responses (json:\"-\" tag)",
        "Proxy keys are hashed before storage",
        "User can only access their own providers and keys",
        "Proxy endpoint validates proxy key before forwarding"
      ]
    }
  },
  "qa_signoff": null,
  "last_updated": "2026-01-03T02:56:06.326750+00:00"
}